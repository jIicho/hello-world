## rebase 사용해서 트리 정리하기

- 병합 (merge) 처럼 두 브랜치를 합칠 때 사용합니다.
- 현재 브랜치가 대상 브랜치 위로 올라갑니다.
- rebase 는 기본 merge와는 달리 트리가 더 깔끔하게 유지된다.
- 단, 원격 저장소로 올린 것에 대한 것은 rebase를 하지 않는다.
- 로컬에서 작업한 것들만 rebase 기능을 사용하자.
- 위험하니 조심히 사용하자.
- 소스트리에서는 '재배치' 라는 명령어이다.

## rebase 의 장단점

- 장점 : 커밋 히스토리가 깔끔하게 정리된다.
- 단점 : 잘못 사용하면 위험하다. <br/>
  이미 원격 저장소에 올라간 경우와 협업을 하고 있는 경우 특히 위험하다.

#### 직접 사용해보자!

- 우리가 지금까지 배웠던 내용으로 병합하는 방법

  1. hello.md 파일을 마지막으로 작업한 커밋(main 자리)에 브랜치를 만든다. (rebase 브랜치)
  2. rebase 로 체크아웃 된 것을 확인 후 hello.md 파일에 내용을 작성한다.
  3. 커밋을 한다.
  4. main 자리에 있는 커밋 우클릭 후 브랜치를 하나 더 만든다. (etc 브랜치)
  5. etc 로 체크아웃 된 것을 확인 후 <br/>
     ( hello.md 파일에 rebase에서 작업한 내용이 사라진 것을 확인 할 수 있다. )<br/>
     rebase 에서 작업한 내용과 다른 내용을 작성한다.
  6. 커밋을 한다.
  7. 두 갈래가 생긴 것을 확인할 수 있다. <br/>
     (rebase와 etc중 하나의 브랜치만 main과 fast-forward 가 가능하다.)
  8. 'main' 브랜치로 옮겨가서(main으로 체크아웃) 'rebase' 브랜치에서 작업한 커밋을 우클릭 후 병합한다.<br/>
     (rebase와 main이 한줄로 있는 것을 확인할 수 있다.)
  9. etc 커밋 우클릭 후 병합
  10. 충돌이 발생한다.
  11. 에디터에서 '두 변경사항 모두 수락' 클릭 후 저장
  12. 커밋한다. (자동으로 커밋 메시지가 작성된다.)
  13. 3 way merge (한 커밋에 부모가 두명이 된다. main, rebase, etc가 한줄로.. )

- rebase 기능을 사용해서 병합하는 방법

  ###### 원격 저장소부분, 원래 main이 있던 자리로 reset 한다.

  1. main 부분 우클릭 후 'merge-test' 브랜치를 생성한다.
  2. merge-test 로 체크아웃 된 것을 확인한다.
  3. etc 브랜치에서 작업한 커밋 우클릭 후 병합한다.
  4. merge-test 가 etc 자리로 fast-forward 된 것을 볼 수 있다.<br/>
     (merge-test 브랜치와 etc 브랜치가 한줄에.)
  5. rebase로 체크아웃
  6. 좌측 브랜치 목록에 있는 'merge-test' 브랜치 우클릭 후
     '현재 변경사항을 merge-test 에 재배치' 클릭 <br/>
     => 나(rebase)를 들어다가 merge-test에 얹는다는 것
  7. 충돌이 발생한다.
  8. 에디터에서 '두 변경사항 모두 수락' 클릭 후 저장
  9. hello.md 파일을 add 하고,
  10. 커밋을 하는 것이 아니라 좌측 브랜치 목록에 있는 'merge-test' 우클릭 후
  11. '현재 변경사항을 merge-test 에 재배치' 클릭 (터미널에서는 rebase continue)
  12. '재배치 계속' 선택
  13. 두 갈래가 아닌 한 줄로 보여지는 것을 확인할 수 있다. (아직...끝나지 않음.)
  14. 'merge-test' 로 체크아웃
  15. 좌측 브랜치 목록에 있는 'rebase' 브랜치 우클릭 후<br/>
      '현재 브랜치로 rebase 병합' 클릭
  16. merge-test 와 rebase가 한줄에 있는 것을 확인할 수 있다.
  17. 원래 우리가 원하는 것은 main 이므로 'main' 체크아웃 한 후
  18. merge-test 와 rebase가 같이 있는 부분 우클릭 후 병합 선택 (main을 병합시킨다.)
  19. 올라간 것을 확인 후 작업이 모두 완료된 브랜치들은 삭제 해준다. <br/>
      한 줄로 깔끔하게 정리된 트리를 볼 수 있다.(merge-test, rebase, etc 브랜치 삭제)
  20. 푸시해주기.

###### 한줄평

- rebase 기능을 사용할 때에 <br/>
  예를 들어, 두 브랜치 A, B 중 <br/>

  1. A 브랜치로 체크아웃 한 후 상대 브랜치 B 우클릭 후 '현재 변경사항을 B 에 재배치' 를 선택하면 충돌이 발생한다.
  2. 이떄 내용 수정을 완료하고 add 한 후 커밋을 하는 것이 아니라, <br/>
     좌측 브랜치 목록에 있는 B 브랜치를 우클릭 한 후 '현재 변경사항을 B 에 재배치' 선택.
  3. 두 갈래가 아닌 한 줄로 트리가 정리된 것을 확인하기.

  4. 나머지 한 브랜치 B 로 체크아웃 한 후 좌측 브랜치 목록에 상대 브랜치 A 우클릭 후 <br/>
     '현재 브랜치로 A 병합' 을 선택.
  5. A 브랜치와 B 브랜치가 한 커밋에 놓여있는 것을 확인하기.
  6. 그 후에 main 으로 체크아웃 한 후 <br/>
     브랜치 A, B가 자리한 커밋을 우클릭 후 병합 선택.
  7. 이미 작업이 완료된 브랜치 삭제해주기.
  8. 푸시하기.
